apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-index
  namespace: default
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <title>A simple HTML document, second revision</title>
    </head>
    <body>
        <p>This is Deployment One!<p>
    </body>
    </html>
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: app
  namespace: flux-system
spec:
  dependsOn:
    - name: infrastructure-configs
  interval: 1h
  retryInterval: 1m
  timeout: 5m
  sourceRef:
    kind: GitRepository
    name: flux-system
  path: ./app
  prune: true
  patches:
    - target:
        name: quickstart-es-http
        namespace: elastic
        kind: Service
      patch: |-
        apiVersion: v1
        kind: Service
        metadata:
          name: quickstart-es-http
          namespace: elastic
        spec:
          selector:
            common.k8s.elastic.co/type: elasticsearch
            elasticsearch.k8s.elastic.co/cluster-name: quickstart
          type: LoadBalancer
